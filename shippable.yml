language: php

php:
  - 5.6

env:
  global:
    - SLACK_CHANNEL='#build_bbapi_test'
    - SLACK_UPLOAD_FILE_URL='https://slack.com/api/files.upload'
    - TEST_RESULTS_DIR=$SHIPPABLE_REPO_DIR/build/workspace/test_results/

build:
  ci:
    - phpunit --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage
  post_ci:
    - cd $TEST_RESULTS_DIR
    - ls -la

#  on_success:
#    - curl -F file=@TEST_RESULTS_DIR"junit-noframes.html" -F "filename=junit-build-"$BUILD_NUMBER".html" -F channels=$SLACK_CHANNEL -F token=$SLACK_API_TOKEN $SLACK_UPLOAD_FILE_URL
#
#  on_failure:
#    - curl -F file=@TEST_RESULTS_DIR"junit-noframes.html" -F "filename=junit-build-"$BUILD_NUMBER".html" -F channels=$SLACK_CHANNEL -F token=$SLACK_API_TOKEN $SLACK_UPLOAD_FILE_URL

#integrations:
#  notifications:
#    - integrationName: Slack (DevTac)
#      type: slack
#      recipients: $SLACK_CHANNEL
#      on_success: always
#      on_failure: always
#      on_pull_request: never
#      on_start: always