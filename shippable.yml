language: php

php:
  - 5.6

env:
  global:
    - SLACK_CHANNEL='#build_bbapi_test'
    - SLACK_UPLOAD_FILE_URL='https://slack.com/api/files.upload'

    - secure: RuP4k5DOs+m8M85BEteDbf2ehi4JPUrnM5sg7UDu4Be2fcol77LW7Yux0/XoMJPjc9kprKSz+S8f/dP/H6BKRh4F7QuH6q/eqHn6DfDj29GwMdTcyfbPzyczbyzAk8xbYjVLsy3UW2ARWb3D5cpyYRCU7C9kBLqUNYnUC0Y1xcjlIILQ8vw+xE9EIpu39xUGexNq0hOdoVU1zpQ44iQMaBJPdRcj+pslYbfhqpJXYKIprxpheU/343KJ1SQFITEv1HEIlQ4SshZiQUXBxVvmlfQ5WTt22P1+iiIs3n+vs8wBsOyGzKpNthpbUliKuOmaRRm4ldgP8K3mEET6vxnWkA==

build:
  ci:
    - phpunit --log-junit shippable/testresults/junit.xml --coverage-xml shippable/codecoverage

  on_success:
    - curl -F file=@shippable/testresults/junit.xml -F "filename=success-build-"$BUILD_NUMBER".html" -F channels=$SLACK_CHANNEL -F token=$SLACK_API_TOKEN $SLACK_UPLOAD_FILE_URL

  on_failure:
    - curl -F file=@shippable/testresults/junit.xml -F "filename=failed-build-"$BUILD_NUMBER".html" -F channels=$SLACK_CHANNEL -F token=$SLACK_API_TOKEN $SLACK_UPLOAD_FILE_URL

integrations:
  notifications:
    - integrationName: Slack (DevTac)
      type: slack
      recipients: "$SLACK_CHANNEL"
      on_success: always
      on_failure: always
      on_pull_request: never
      on_start: always